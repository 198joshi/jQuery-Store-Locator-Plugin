/*
* storeLocator v1.0 - jQuery store locator plugin
* Version: 1.0
* (c) Copyright 2012, Bjorn Holine (http://www.bjornblog.com)
* Released under the MIT license
* Distance calculation function by Chris Pietschmann: http://pietschsoft.com/post/2008/02/01/Calculate-Distance-Between-Geocodes-in-C-and-JavaScript.aspx
*/

(function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"list",formID:"user-location",zoomLevel:12,pinColor:"fe7569",pinTextColor:"000000",storeLimit:26,distanceAlert:60,xmlLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",bounceMarker:true,slideMap:true},b);
return this.each(function(){var l=a(this);if(c.slideMap==true){l.hide();}var k,n,o,h,e,f,i;var g=new Array();var m={};m.EarthRadiusInMiles=3956;m.EarthRadiusInKilometers=6367;
m.ToRadian=function(p){return p*(Math.PI/180);};m.DiffRadian=function(q,p){return m.ToRadian(p)-m.ToRadian(q);};m.CalcDistance=function(t,s,r,q,p){return p*2*Math.asin(Math.min(1,Math.sqrt((Math.pow(Math.sin((m.DiffRadian(t,r))/2),2)+Math.cos(m.ToRadian(t))*Math.cos(m.ToRadian(r))*Math.pow(Math.sin((m.DiffRadian(s,q))/2),2)))));
};f=new google.maps.Geocoder();function j(){this.geocode=function(p,q){f.geocode({address:p},function(t,s){if(s==google.maps.GeocoderStatus.OK){var r={};
r.latitude=t[0].geometry.location.lat();r.longitude=t[0].geometry.location.lng();q(r);}else{alert("Geocode was not successful for the following reason: "+s);
q(null);}});};}a(function(){a("#"+c.formID).live("submit",function(r){r.preventDefault();var s=a("form").serialize();s=s.replace("address=","");if(s==""){alert("The input box was blank.");
}var q=new j();var p=s;q.geocode(p,function(t){if(t!=null){n=t.latitude;o=t.longitude;d(n,o);}else{alert("ERROR! Unable to geocode address");}});s=s.replace(" ","+");
});});function d(p,q){a(function(){a.ajax({type:"GET",url:c.xmlLocation,dataType:"xml",success:function(r){var s=0;a(r).find("marker").each(function(){var w=a(this).attr("name");
var E=a(this).attr("lat");var F=a(this).attr("lng");var G=a(this).attr("address");var v=a(this).attr("address2");var A=a(this).attr("city");var u=a(this).attr("state");
var C=a(this).attr("postal");var D=a(this).attr("phone");var B=a(this).attr("web");B=B.replace("http://","");var z=a(this).attr("hours1");var y=a(this).attr("hours2");
var x=a(this).attr("hours3");var t=m.CalcDistance(p,q,E,F,m.EarthRadiusInMiles);g[s]=new Array(t,w,E,F,G,v,A,u,C,D,B,z,y,x);s++;});g.sort(function(v,u){var t=v[0];
var w=u[0];return((t<w)?-1:((t>w)?1:0));});if(g[0][0]>c.distanceAlert){alert("Unfortunately, our closest location is more than "+c.distanceAlert+" miles away.");
}a(function(){var J,H,F,w,M,u,N,x,E,D,C;function K(y){J=g[y][1];H=g[y][4];F=g[y][5];w=g[y][6];M=g[y][7];u=g[y][8];N=g[y][9];x=g[y][10];E=g[y][11];D=g[y][12];
C=g[y][13];}var G={zoom:c.zoomLevel,center:new google.maps.LatLng(p,q),mapTypeId:google.maps.MapTypeId.ROADMAP};if(c.slideMap==true){l.slideDown();}var P=new google.maps.Map(document.getElementById(c.mapDiv),G);
var O=new Array();var B=new google.maps.InfoWindow();if((g.length-1)<c.storeLimit-1){i=g.length-1;}else{i=c.storeLimit-1;}for(var A=0;A<=i;A++){console.log(A);
var Q=String.fromCharCode("A".charCodeAt(0)+A);console.log(Q);var L=new google.maps.LatLng(g[A][2],g[A][3]);h=t(L,g[A][1],g[A][4],Q);O[A]=h;K(A);v(h,J,H,F,w,M,u,N,x,E,D,C);
}a("#"+c.listDiv).empty();a(O).each(function(y,R){var S=String.fromCharCode("A".charCodeAt(0)+y);K(y);I(S,R,J,H,F,w,M,u,N,x,E,D,C);});function I(V,aa,S,T,R,Z,y,U,ac,ab,Y,X,W){a("<li />").html('<div class="list-label">'+V+'</div><div class="list-details"><div class="list-content"><div class="loc-name">'+J+'</div> <div class="loc-addr">'+H+'</div> <div class="loc-addr2">'+F+'</div> <div class="loc-addr3">'+w+", "+M+" "+u+'</div> <div class="loc-phone">'+N+'</div> <div class="loc-web"><a href="http://'+x+'" target="_blank">'+x+"</a></div></div></div>").click(function(){P.panTo(aa.getPosition());
var ad="left";if(c.bounceMarker==true){aa.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){aa.setAnimation(null);v(aa,S,T,R,Z,y,U,ac,ab,Y,X,W,ad);
},700);}else{v(aa,S,T,R,Z,y,U,ac,ab,Y,X,W,ad);}}).appendTo("#"+c.listDiv);}a("#"+c.listDiv+" li:even .list-details").css("background","#"+c.listColor1);
a("#"+c.listDiv+" li:odd .list-details").css("background","#"+c.listColor2);function t(y,T,S,W){var V=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+W+"|"+c.pinColor+"|"+c.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));
var U=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
var R=new google.maps.Marker({position:y,map:P,icon:V,shadow:U,draggable:false});return R;}function z(y){var R;if(y!=""){R="<div>"+y+"</div>";}else{R="";
}return R;}function v(aa,S,T,R,Y,y,U,ac,ab,X,W,V,ad){var Z='<div class="loc-name">'+S+"</div>"+z(T)+z(R)+Y+", "+y+" "+U+z(X)+z(W)+z(V)+z(ac)+'<div><a href="http://'+ab+'" target="_blank">'+ab+"</a></div>";
if(ad=="left"){B.setContent(Z);B.open(aa.get(c.mapDiv),aa);}else{google.maps.event.addListener(aa,"click",function(){B.setContent(Z);B.open(aa.get(c.mapDiv),aa);
});}}});}});});}});};})(jQuery);