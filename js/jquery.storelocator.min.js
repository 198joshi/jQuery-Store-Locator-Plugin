/*
* storeLocator v1.2 - jQuery store locator plugin
* (c) Copyright 2012, Bjorn Holine (http://www.bjornblog.com)
* Released under the MIT license
* Distance calculation function by Chris Pietschmann: http://pietschsoft.com/post/2008/02/01/Calculate-Distance-Between-Geocodes-in-C-and-JavaScript.aspx
*/

(function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"list",formID:"user-location",inputID:"address",zoomLevel:12,pinColor:"fe7569",pinTextColor:"000000",storeLimit:26,distanceAlert:60,dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",bounceMarker:true,slideMap:true,modalWindow:false,defaultLoc:false,defaultLat:"",defaultLng:"",jsonData:false},b);
return this.each(function(){var m=a(this);if(c.modalWindow==true){m.wrap('<div id="overlay"><div id="modal-window"><div id="modal-content">');a("#modal-window").prepend('<div id="close-icon"></div>');
a("#overlay").hide();}if(c.slideMap==true){m.hide();}if(c.defaultLoc==true){d(c.defaultLat,c.defaultLng);}var l,o,p,i,e,g,j;var h=new Array();var n={};
n.EarthRadiusInMiles=3956;n.EarthRadiusInKilometers=6367;n.ToRadian=function(q){return q*(Math.PI/180);};n.DiffRadian=function(r,q){return n.ToRadian(q)-n.ToRadian(r);
};n.CalcDistance=function(u,t,s,r,q){return q*2*Math.asin(Math.min(1,Math.sqrt((Math.pow(Math.sin((n.DiffRadian(u,s))/2),2)+Math.cos(n.ToRadian(u))*Math.cos(n.ToRadian(s))*Math.pow(Math.sin((n.DiffRadian(t,r))/2),2)))));
};g=new google.maps.Geocoder();function k(){this.geocode=function(q,r){g.geocode({address:q},function(u,t){if(t==google.maps.GeocoderStatus.OK){var s={};
s.latitude=u[0].geometry.location.lat();s.longitude=u[0].geometry.location.lng();r(s);}else{alert("Geocode was not successful for the following reason: "+t);
r(null);}});};}function f(r,s){var q=Math.round(r*Math.pow(10,s))/Math.pow(10,s);return q;}a(function(){a(document).on("submit","#"+c.formID,function(s){s.preventDefault();
var t=a("#"+c.formID+" #"+c.inputID).serialize();t=t.replace("address=","");if(t==""){alert("The input box was blank.");}else{var r=new k();var q=t;r.geocode(q,function(u){if(u!=null){o=u.latitude;
p=u.longitude;d(o,p);}else{alert("ERROR! Unable to geocode address");}});}});});function d(q,r){a(function(){var s;if(c.jsonData==true){s="json";}else{s="xml";
}a.ajax({type:"GET",url:c.dataLocation,dataType:s,success:function(u){var t=0;if(c.jsonData==true){a.each(u,function(){var y=this.locname;var G=this.lat;
var H=this.lng;var I=this.address;var x=this.address2;var C=this.city;var w=this.state;var E=this.postal;var F=this.phone;var D=this.web;D=D.replace("http://","");
var B=this.hours1;var A=this.hours2;var z=this.hours3;var v=n.CalcDistance(q,r,G,H,n.EarthRadiusInMiles);h[t]=new Array(v,y,G,H,I,x,C,w,E,F,D,B,A,z);t++;
});}else{a(u).find("marker").each(function(){var y=a(this).attr("name");var G=a(this).attr("lat");var H=a(this).attr("lng");var I=a(this).attr("address");
var x=a(this).attr("address2");var C=a(this).attr("city");var w=a(this).attr("state");var E=a(this).attr("postal");var F=a(this).attr("phone");var D=a(this).attr("web");
D=D.replace("http://","");var B=a(this).attr("hours1");var A=a(this).attr("hours2");var z=a(this).attr("hours3");var v=n.CalcDistance(q,r,G,H,n.EarthRadiusInMiles);
h[t]=new Array(v,y,G,H,I,x,C,w,E,F,D,B,A,z);t++;});}h.sort(function(z,w){var v=z[0];var A=w[0];return((v<A)?-1:((v>A)?1:0));});if(h[0][0]>c.distanceAlert){alert("Unfortunately, our closest location is more than "+c.distanceAlert+" miles away.");
}a(function(){var T,L,J,H,z,O,w,P,A,G,F,E;function M(y){T=h[y][0];L=h[y][1];J=h[y][4];H=h[y][5];z=h[y][6];O=h[y][7];w=h[y][8];P=h[y][9];A=h[y][10];G=h[y][11];
F=h[y][12];E=h[y][13];T=f(T,2);}var I={zoom:c.zoomLevel,center:new google.maps.LatLng(q,r),mapTypeId:google.maps.MapTypeId.ROADMAP};if(c.slideMap==true){m.slideDown();
}if(c.modalWindow==true){a("#overlay").fadeIn();a(document).on("click","#close-icon",function(){a("#overlay").hide();});a(document).on("click","#overlay",function(){a("#overlay").hide();
});a(document).on("click","#modal-window",function(y){y.stopPropagation();});a(document).keyup(function(y){if(y.keyCode==27){a("#overlay").hide();}});}var R=new google.maps.Map(document.getElementById(c.mapDiv),I);
var Q=new Array();var D=new google.maps.InfoWindow();if((h.length-1)<c.storeLimit-1){j=h.length-1;}else{j=c.storeLimit-1;}for(var C=0;C<=j;C++){var S=String.fromCharCode("A".charCodeAt(0)+C);
var N=new google.maps.LatLng(h[C][2],h[C][3]);i=v(N,h[C][1],h[C][4],S);Q[C]=i;M(C);x(i,L,J,H,z,O,w,P,A,G,F,E);}a("#"+c.listDiv).empty();a(Q).each(function(y,U){var V=String.fromCharCode("A".charCodeAt(0)+y);
M(y);K(T,V,U,L,J,H,z,O,w,P,A,G,F,E);});function K(U,aa,af,X,Z,W,ae,V,Y,ah,ag,ad,ac,ab){var y;if(U<=1){y="mile";}else{y="miles";}a("<li />").html('<div class="list-label">'+aa+'</div><div class="list-details"><div class="list-content"><div class="loc-name">'+L+'</div> <div class="loc-addr">'+J+'</div> <div class="loc-addr2">'+H+'</div> <div class="loc-addr3">'+z+", "+O+" "+w+'</div> <div class="loc-phone">'+P+'</div> <div class="loc-web"><a href="http://'+A+'" target="_blank">'+A+'</a></div><div class="loc-dist">'+U+" "+y+"</div></div></div>").click(function(){R.panTo(af.getPosition());
var ai="left";if(c.bounceMarker==true){af.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){af.setAnimation(null);x(af,X,Z,W,ae,V,Y,ah,ag,ad,ac,ab,ai);
},700);}else{x(af,X,Z,W,ae,V,Y,ah,ag,ad,ac,ab,ai);}}).appendTo("#"+c.listDiv);}a("#"+c.listDiv+" li:even .list-details").css("background","#"+c.listColor1);
a("#"+c.listDiv+" li:odd .list-details").css("background","#"+c.listColor2);function v(y,W,V,Z){var Y=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+Z+"|"+c.pinColor+"|"+c.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));
var X=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
var U=new google.maps.Marker({position:y,map:R,icon:Y,shadow:X,draggable:false});return U;}function B(y){var U;if(y!=""){U="<div>"+y+"</div>";}else{U="";
}return U;}function x(ad,V,W,U,ab,y,X,af,ae,aa,Z,Y,ag){var ac='<div class="loc-name">'+V+"</div>"+B(W)+B(U)+ab+", "+y+" "+X+B(aa)+B(Z)+B(Y)+B(af)+'<div><a href="http://'+ae+'" target="_blank">'+ae+"</a></div>";
if(ag=="left"){D.setContent(ac);D.open(ad.get(c.mapDiv),ad);}else{google.maps.event.addListener(ad,"click",function(){D.setContent(ac);D.open(ad.get(c.mapDiv),ad);
});}}});}});});}});};})(jQuery);